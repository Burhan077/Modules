#!/bin/bash
DATAFILE="$HOME/.config/hypr/floatingsizes.json"
if ! command -v jq &>/dev/null; then echo "Install jq!"; exit 1; fi
WINDOW_JSON=$(hyprctl activewindow -j)
APP=$(echo "$WINDOW_JSON" | jq -r '.class')
if [[ -z "$APP" || "$APP" == "null" ]]; then echo "No active window."; exit 1; fi
if [[ ! -f "$DATAFILE" ]] || ! jq empty "$DATAFILE" 2>/dev/null; then
  echo "No saved geometry found."
  exit 0
fi
X=$(jq -r --arg app "$APP" '.[$app].x // empty' "$DATAFILE")
Y=$(jq -r --arg app "$APP" '.[$app].y // empty' "$DATAFILE")
W=$(jq -r --arg app "$APP" '.[$app].w // empty' "$DATAFILE")
H=$(jq -r --arg app "$APP" '.[$app].h // empty' "$DATAFILE")

# Float the window and restore geometry
hyprctl dispatch setfloating
sleep 0.15
if [[ -n "$X" && -n "$Y" && -n "$W" && -n "$H" ]]; then
  hyprctl dispatch movewindowpixel exact "$X" "$Y"
  hyprctl dispatch resizewindowpixel exact "$W" "$H"
fi

